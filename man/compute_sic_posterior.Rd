% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/sic_extraction.R
\name{compute_sic_posterior}
\alias{compute_sic_posterior}
\title{Compute Spatial Interaction Curve Posteriors}
\usage{
compute_sic_posterior(
  fit,
  prep,
  level = c("group", "patient", "image"),
  indices = NULL,
  distance_seq = seq(0, 100, by = 1),
  sources = NULL
)
}
\arguments{
\item{fit}{A CmdStan model fit object returned by `run_SHADE_model()`.}

\item{prep}{The preprocessing object returned by `prepare_spatial_model_data()`.}

\item{level}{Character string specifying hierarchical level: "image", "patient", or "group".}

\item{indices}{Optional integer vector specifying which images/patients/groups to extract.
If NULL (default), extracts all available at the specified level.}

\item{distance_seq}{Numeric vector of distances at which to evaluate SICs.
Default: seq(0, 100, by = 1).}

\item{sources}{Optional character vector of source cell types to extract.
If NULL (default), extracts all source types.}
}
\value{
A tibble with columns:
  \item{distance}{Distance value}
  \item{source}{Source cell type name}
  \item{level_id}{ID at the specified level (image/patient/group number)}
  \item{level_name}{Name at the specified level (if available in metadata)}
  \item{sic}{rvar object containing posterior draws of the SIC}
}
\description{
Extracts posterior distributions of Spatial Interaction Curves (SICs) from a
fitted SHADE model at the specified hierarchical level (image, patient, or group).
Returns posteriors as rvar objects for flexible downstream analysis.
}
\details{
The function extracts coefficients at the specified hierarchical level:
\itemize{
  \item \strong{image}: Uses `beta_local` - image-specific coefficients
  \item \strong{patient}: Uses `beta_indiv` - patient-specific coefficients
  \item \strong{group}: Uses `beta_global` - group-level coefficients
}

SICs represent how target cell density varies with distance from source cells.
The returned rvar objects can be used with `posterior` package functions or
passed to `add_simultaneous_bands()` or `add_pointwise_bands()` for uncertainty
quantification.
}
\examples{
\dontrun{
library(dplyr)
library(posterior)

# Fit model
fit <- run_SHADE_model(prep$stan_data)

# Extract group-level SICs
sics_group <- compute_sic_posterior(fit, prep, level = "group")

# Extract patient-level SICs for specific patients
sics_patients <- compute_sic_posterior(
  fit, prep,
  level = "patient",
  indices = c(1, 3, 5)
)

# Add credible bands and plot
sics_group \%>\%
  add_simultaneous_bands(alpha = 0.1) \%>\%
  ggplot(aes(x = distance, y = sic_mean, color = level_name)) +
    geom_ribbon(aes(ymin = sic_lower, ymax = sic_upper, fill = level_name), alpha = 0.2) +
    geom_line() +
    facet_wrap(~source)
}

}
