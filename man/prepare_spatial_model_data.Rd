% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/preprocessing.R
\name{prepare_spatial_model_data}
\alias{prepare_spatial_model_data}
\title{Prepare Spatial Model Input Data}
\usage{
prepare_spatial_model_data(
  x,
  y,
  cell_type,
  image_id,
  patient_metadata,
  n_dummy = 1000,
  type_idx = 1,
  covariate_list = NULL,
  quadrature_list = NULL,
  potentials = NULL,
  path = NULL,
  mean_alpha = -10,
  scale_sigmas = 5,
  scale_sigma_betas = NULL,
  scale_sigma_alpha = 5,
  n_basis_functions = 3,
  max_dist = 75,
  basis_function_sigma = 15
)
}
\arguments{
\item{x}{Numeric vector of x-coordinates.}

\item{y}{Numeric vector of y-coordinates.}

\item{cell_type}{Factor or character vector of cell types (filtered).}

\item{image_id}{Character or factor vector of image/sample IDs.}

\item{patient_metadata}{A data frame with columns: 'Spot', 'Patient' and'Group'.}

\item{n_dummy}{Number of dummy points for quadrature (default: 1000).}

\item{type_idx}{Index of the cell type to model (default: 1).}

\item{covariate_list}{Optional named list of covariate matrices, one per image. Each matrix should have
one row per quadrature point (data + dummy points for the focal cell type) and one column per covariate.
List names must match the levels of `image_id`. If NULL (default), no covariates are included.}

\item{quadrature_list}{Optional named list of pre-made quadrature schemes (from make_quadrature), one per image.
If provided, these will be used instead of generating new quadrature schemes internally.
List names must match the levels of `image_id`. Useful when you need to create covariates that
match specific quadrature points.}

\item{potentials}{Optional list of custom potential (basis) functions. Each function should take a distance
and return a scalar value. If NULL (default), creates standard RBFs using make_rbfs() with the
n_basis_functions, max_dist, and basis_function_sigma parameters. Useful for custom basis functions
such as truncated RBFs or alternative functional forms.}

\item{path}{Optional directory path to write output files. If NULL, returns data in memory.}

\item{mean_alpha}{Mean of prior on intercept (default: -10).}

\item{scale_sigmas}{Scale for prior on interaction strengths (default: 5).}

\item{scale_sigma_betas}{Scale for prior on feature coefficients (default: seq(5, 1, length.out = num_pot)).}

\item{scale_sigma_alpha}{Scale for intercept prior (default: 5).}

\item{n_basis_functions}{Number of RBF basis functions (default: 3). Only used if potentials is NULL.}

\item{max_dist}{Maximum distance for RBF support (default: 75). Only used if potentials is NULL.}

\item{basis_function_sigma}{Spread of RBF functions (default: 15). Only used if potentials is NULL.}
}
\value{
A list with elements `stan_data`, `sparse_matrix`, and `metadata` if `path` is NULL.
Otherwise, writes outputs and returns invisibly.
}
\description{
Prepares spatial point pattern data and design matrices for hierarchical Bayesian modeling
of cell interactions in tissues. Assumes input data has already been filtered to relevant cell types.
}
